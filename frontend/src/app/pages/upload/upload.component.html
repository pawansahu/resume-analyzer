<div class="upload-container">
  <mat-card class="upload-card">
    <mat-card-header>
      <mat-card-title>Upload Your Resume</mat-card-title>
      <mat-card-subtitle>
        Upload your resume in PDF or DOCX format (max 5MB) for instant analysis
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <!-- Drop Zone -->
      <div
        class="drop-zone"
        [class.dragging]="isDragging"
        [class.has-file]="selectedFile"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)"
        *ngIf="!selectedFile"
      >
        <mat-icon class="upload-icon">cloud_upload</mat-icon>
        <h3>Drag & Drop your resume here</h3>
        <p>or</p>
        <label for="file-input" class="file-input-label">
          <button mat-raised-button color="primary" type="button">
            <mat-icon>folder_open</mat-icon>
            Browse Files
          </button>
        </label>
        <input
          id="file-input"
          type="file"
          accept=".pdf,.docx"
          (change)="onFileSelected($event)"
          hidden
        />
        <p class="file-requirements">
          Supported formats: PDF, DOCX | Maximum size: 5MB
        </p>
      </div>

      <!-- Selected File Display -->
      <div class="selected-file" *ngIf="selectedFile && !uploadProgress">
        <div class="file-info">
          <mat-icon class="file-icon">{{ getFileIcon() }}</mat-icon>
          <div class="file-details">
            <h4>{{ selectedFile.name }}</h4>
            <p>{{ getFileSize(selectedFile.size) }}</p>
          </div>
          <button
            mat-icon-button
            color="warn"
            (click)="removeFile()"
            aria-label="Remove file"
          >
            <mat-icon>close</mat-icon>
          </button>
        </div>
        <div class="file-actions">
          <button
            mat-raised-button
            color="primary"
            (click)="uploadFile()"
            class="upload-button"
          >
            <mat-icon>upload</mat-icon>
            Upload & Analyze
          </button>
        </div>
      </div>

      <!-- Upload Progress -->
      <div class="upload-progress" *ngIf="uploadProgress">
        <div class="progress-info">
          <mat-icon
            class="status-icon"
            [class.uploading]="uploadProgress.status === 'uploading'"
            [class.processing]="uploadProgress.status === 'processing'"
            [class.complete]="uploadProgress.status === 'complete'"
            [class.error]="uploadProgress.status === 'error'"
          >
            <ng-container *ngIf="uploadProgress.status === 'uploading'">
              cloud_upload
            </ng-container>
            <ng-container *ngIf="uploadProgress.status === 'processing'">
              hourglass_empty
            </ng-container>
            <ng-container *ngIf="uploadProgress.status === 'complete'">
              check_circle
            </ng-container>
            <ng-container *ngIf="uploadProgress.status === 'error'">
              error
            </ng-container>
          </mat-icon>
          <div class="progress-details">
            <h4>{{ uploadProgress.message }}</h4>
            <p *ngIf="selectedFile">{{ selectedFile.name }}</p>
          </div>
        </div>

        <mat-progress-bar
          *ngIf="uploadProgress.status === 'uploading' || uploadProgress.status === 'processing'"
          mode="determinate"
          [value]="uploadProgress.progress"
        ></mat-progress-bar>

        <mat-progress-bar
          *ngIf="uploadProgress.status === 'complete'"
          mode="determinate"
          [value]="100"
          color="accent"
        ></mat-progress-bar>

        <!-- Error Actions -->
        <div class="error-actions" *ngIf="uploadProgress.status === 'error'">
          <button mat-raised-button color="primary" (click)="retryUpload()">
            <mat-icon>refresh</mat-icon>
            Retry Upload
          </button>
          <button mat-button (click)="removeFile()">
            <mat-icon>close</mat-icon>
            Cancel
          </button>
        </div>

        <!-- Success Actions -->
        <div class="success-actions" *ngIf="uploadProgress.status === 'complete'">
          <button mat-raised-button color="primary" (click)="viewResults()">
            <mat-icon>assessment</mat-icon>
            View Analysis Results
          </button>
          <button mat-button (click)="removeFile()">
            <mat-icon>upload</mat-icon>
            Upload Another Resume
          </button>
        </div>
      </div>

    </mat-card-content>
  </mat-card>

  <!-- Analysis Results -->
  <div class="analysis-results" *ngIf="analysisId && atsScore">
    <app-ats-score-card [score]="atsScore"></app-ats-score-card>
    <app-score-breakdown [breakdown]="atsScore.breakdown"></app-score-breakdown>
    <app-recommendations-list [recommendations]="recommendations"></app-recommendations-list>
    <app-jd-comparison [analysisId]="analysisId"></app-jd-comparison>
  </div>

  <!-- Features Info -->
  <div class="features-info">
    <h3>What You'll Get</h3>
    <div class="feature-list">
      <div class="feature-item">
        <mat-icon color="primary">check_circle</mat-icon>
        <div>
          <h4>ATS Compatibility Score</h4>
          <p>See how well your resume performs with applicant tracking systems</p>
        </div>
      </div>
      <div class="feature-item">
        <mat-icon color="primary">check_circle</mat-icon>
        <div>
          <h4>Keyword Analysis</h4>
          <p>Identify important keywords and optimize your content</p>
        </div>
      </div>
      <div class="feature-item">
        <mat-icon color="primary">check_circle</mat-icon>
        <div>
          <h4>Actionable Recommendations</h4>
          <p>Get specific suggestions to improve your resume</p>
        </div>
      </div>
      <div class="feature-item">
        <mat-icon color="primary">check_circle</mat-icon>
        <div>
          <h4>Job Description Matching</h4>
          <p>Compare your resume against specific job postings</p>
        </div>
      </div>
    </div>
  </div>
</div>
